h2. Velocity examples

A template body can be written in plain HTML or combination of HTML and Velocity markup. The available objects for the Velocity context are described in API for templates.

h3. Title of the page

bc. $resource.getTitle()

h3. Get a service object

bc. #set ($resources = $services.getResources())
#set ($folders = $services.getFolders())

h3. Display paragraph

bc. $resource.getParagraph("HEADER").getText()

h3. Array and random selection

Random access (assuming that an instance of java.util.Random in the Velocity context with name random).

bc. #set( $randomStyles = ["one", "two", "three", "four", "five", "six", "seven", "eight"] )
<body id="home" class="$randomStyles.get($random.nextInt(8))">

h3. Create a content index

bc. #set($folderResource= $resources.resourceForPathSecure("/Events"))
#set($type = $enums.of("ccc.types.ResourceType", "PAGE"))
#set($criteria = $apiTypes.createResourceCriteria())
$criteria.setParent($folderResource.getId())
$criteria.setPublished(true)
$criteria.setMainmenu(true)
$criteria.setType($type)

bc. #set($folder = $resources.list($criteria,1,20))

bc. #foreach ($pageRS in $folder)
    #set($page = $pages.retrieve($pageRS.getId()))
    <h2><a href="$pageRS.getAbsolutePath()">$pageRS.getTitle()</a></h2>
    <p>$page.getParagraph("Summary").getText()</p>
    <ul class="eventlist">
    #set($rawDate = $page.getParagraph("Date").getDate())
    <li>Date: $dateTool.format('d MMMMM yyyy', $rawDate)</li>
    <li>Time: $page.getParagraph("Time").getText()</li>
    </ul>
#end

h3. Display search results (for 'search' resource's template)

bc. #set($resources = $services.getResources())
#foreach($hit in $result.hits()) 
    #if($resources.exists($hit))
        #set ($hitResource = $resources.retrieve($hit))
        $hitResource.getTitle()</br>
    #end
#end

bc. <form name="search" action="$resource.getName()">
    <input name="q" autocomplete="off" value="$terms"/>
    <input type="submit" value="Search"  name="go"/>
</form>
 
bc. Shown Hits: $!result.hits().size() - Total: $!result.totalResults()
 
bc. #set ( $pages=($result.totalResults()+9)/10 )
#if ( $result.totalResults()>0 ) 
    #foreach( $page in [1..$pages] ) 
        #set ( $linkNumber=($page+-1) )
        #if ( $linkNumber==$pageNumber )
            <b>$page</b>
        #elseif ( $linkNumber!=$pageNumber )
            <a href="$resource.name()?q=$terms&p=$linkNumber">$page</a>
        #end
    #end
#end

h3. Display optional paragraph

bc. #macro( optional $name $startText $endText)
    #foreach( $para in $resource.getParagraphs() )
        #if ($para.getName()==$name && $para.getText())
            $startText
            $para.getText()
            $endText
        #end
    #end
#end

Normal @$resource.getParagraph("NAME").getText()@ causes an exception in case there is no paragraph with matching name.

Following macro takes three parameters. @$name@ is for the paragraph name, @$startText@ is the text to be appended before the paragraph text, @$endText@ is the text to be appended after the paragraph.

Usage:

bc. #optional('PanelOne_Custom' '<div id="panel">' '</div>' )

h3. Display breadcrumb

bc. #macro ( breadcrumb) 
   #foreach ($element in $resource.getAbsolutePath().substring(9).split("/"))
      $element
      <br/>
   #end
#end

h3. Include another resource

bc. #include("/assets/templates/header.vm")

h3. Parse another resource

bc. #parse("/assets/templates/header.vm")

h3. Read metadata value with default value

bc. #macro(getStyle)
    #if(!$resource.getMetadatum("bodyId"))
        default
    #else 
        $resource.getMetadatum("bodyId")
    #end
#end

bc. #getStyle

h3. Display current year

bc. #macro (currentYear)
    #set ($cal = $calendar.getInstance())
    $cal.get(1)
#end

or

bc. $dateTools.get('yyyy')

h3. Display image type paragraph

bc. #macro( optionalImage $name)
    #foreach( $para in $resource.getParagraphs() )
        #if ($para.getName() == $name &amp;&amp; $para.getText())
            #set($imageResource = $resources.retrieve($uuid.fromString($para.getText())))
            $imageResource.getAbsolutePath()
        #end
    #end
#end
